# I) Cấu trúc vi điều khiển
- ARM Cortex M4 CPU: so vs M3 có tốc độ xử lý tối đa 72Mhz thì M4 có tốc độ 168MHz, khả năng thực thi lệnh nhanh hơn
- Flash có thể lên đến 1MB, 2 vùng nhớ SRAM
- Nhiều ngoại vi của mỗi loại và có thêm 1 số ngoại vi khác như Erthenet, USB OTG
- Data Bus

![STM32F407 Block Diagram](https://github.com/giangnamtud/STM32/assets/165153939/b5b95902-8823-4ffc-b301-6727fe18dc33)

## Bài tập 1:

STM32F407VG MCU

Ordering Information
![Ordering Information](https://github.com/giangnamtud/STM32/assets/165153939/ad8736f3-69bc-4afe-894b-ca827ccead28)

### 1. Vi điều khiển của bạn có tổng cộng bao nhiêu chân (Pin)?

Từ trong Ordering Information: Pin counts G = 100 Pins


### 2. Có bao nhiêu I/O Pin?
![Peripherals count con](https://github.com/giangnamtud/STM32/assets/165153939/912a6d95-6687-4db0-9fab-4e75582e5807)

82 GPIOS: Có thể lập trình Input/ Output được

![Pinouts and Pins description](https://github.com/giangnamtud/STM32/assets/165153939/f79c84d3-51e2-47c6-adb6-c0a4efe77a8d)


### 3. Được chia làm bao nhiêu Port?
- Các chân GPIO được đánh kí hiệu theo kiểu PA, PB, PC, ... tương ứng với các Port. Với mỗi chân trong mỗi Port lại được đánh số lần lượt từ 0,1... Người ta chia ra các Port để quản lý
- Trong hình có các Port PA, PB, PC, PD, PE, PH => ta có 6 Port


### 4. Mỗi Port có bao nhiêu Pin?
- PA: 16 Pins
- PB: 16 Pins
- PC: 16 Pins
- PD: 16 Pins
- PE: 16 Pins
- PH: 2 Pins
=> Có tổng 82 GPIO
  Tù MCU 8, 16 Bits thì có tối đa 8 Pins. Với MCU 32 Bits mỗi ộ có tối đa 16 Pins


### 5. Liệt kê những Pin còn lại không phải GPIO?
- Ta thâý kí hiệu VCC vs GND, đó là những thiết bị được thiết kế ới công nghệ TTL (Transistor-transistor logic). VCC là điện áp cấp vào cực C (Collector), GND là cực nối đất. Sau đó công nghệ thiết kế tối ưu hơn là CMOS, có 2 cực D (Drain) và cực S (Source) thì sẽ có kí hiệu VDD, VSS (tương tự chức năng như VCC, GND). Chúng đều là chân cấp nguồn cho vi điều khiển. 
Câu hỏi bây h là: Liệu chỉ cần cấp nguồn vào 1 cặp hay là tất cả các cặp? Câu trả lời là KHÔNG, PHẢI CẤP NGUỒN VÀO ĐỦ CẶP CHÂN. Bên trong MCU có các mạch digital và analog thì cặp chân đánh số cấp nguồn cho mạch digital còn cặp chân đánh chữ A cấp nguồn cho mạch analog
  + VDD_1,2,3..; 
  + VDDA:
  + VSS_1,2,3..;
  + VSSA:

- VBAT: sử dụng pin cúc áo CMOS, thông thương có những mạch cần, có những mạch thì không cần dùng. Các mạch mainboard máy tính hoặc cách mạch có yếu tố liên quan đến thời gian thì có thiết kế CMOS này. Bên trong MCU này có vi mạch đếm thời gian thực (chạy giống như đồng hồ, có ngày tháng năm giờ phút giây, có thể hẹn giờ). Vi mạch này khi mất nguồn chính thì để đảm bảo thời gian bên trong nó chạy đúng, thì nó yêu cầu thiết kế viên pin vào chân VBAT. Khi mất điện chính thì nó tự động switch sang VBAT để nuôi khối thời gian, để làm sao khi khời động lại thì thời gian vẫn được hiện thị đúng.

- NRST: chân khời động. Khi chân nayg được tích cực thì chương trình trong MCU sẽ chạy lại từ đầu. Mạch này sẽ reset khi chân này tích cực mức negative (khi chân này có mức logic = 0)

- BOOTO: Ta hình dung máy tính của mình khi cài Win, khi đó thì người ta dùng 1 ổ cứng rời bên ngoài khác hoặc USB khác có chưa chương trình để cài Win. Khi khởi động ta sẽ chọn nó sẽ khởi động từ ổ cứng bên ngoài. Khi đó ở cứng bên ngoài sẽ kiểm soát và cài lại Win cho ổ cứng bên trong. Ở đây cũng như vậy. Chân BOOT có khả năng chọn được vùng nhớ khởi động, vùng nhớ thực thi lệnh. Ta có thể chọn chương trình chạy từ vùng nhớ nào bởi vì bên trong MCU có bộ nhớ Flash. Bộ nhớ Flash có thể chia thành các vùng khác nhau (VD: Flash của người dùng, Flash của hãng ST). Có thể chọn từ chương trình khởi động của người dùng hay chương trình có sẵn của hãng ST (Bootloader), hoặc có thể chọn khởi động từ vùng nhớ RAM. Tương tự như việc chọn khởi động từ bộ nhớ nhau. Thường để mặc định cho nó chọn vùng nhớ Flash của người dùng

- VCAP_1,2 :

- VREF+: 

Những chân này không lập trình Input, Output được mà nó thực hiện 1 chức năng cụ thể nào đó, VD: cấp nguồn cho khối digital/ analog, khơi dộng lại chương trình, cấp nguồn dự phòng cho khối thời gian thực, chọn vùng nhớ khởi động. Còn lại là các chân GPIO


### 6. Điện áp nguồn hoạt động của vi điều khiển là bao nhiêu?

![STM32F407 feature](https://github.com/giangnamtud/STM32/assets/165153939/5b08d91e-a336-4260-a71e-73b135ff120a)

1.8 V to 3.6 V application supply and I/Os
Nguồn cung cấp thường là 1 dải điện áp, không phải 1 giá trị cố định. Trong khoảng điện áp này ta thường cấp điện áp 2.5V; 3V; 3.3V (không quá mức điện áp cao nhất và không thấp hơn mức điện áp thấp nhất) nhưng phổ thông nhất là 3.3V vì điện áp nay là tiêu chuẩn cho CMOS (rất nhiều thiết bị có nguồn cấp là 3.3V). Tuy nhiên người ta vẫn có thể cấp nguồn 2.5V hay 3V tùy vào ứng dụng của họ. Có những ứng dụng tiết kiệm năng lượng thì người ta thiết kế nguồn cung cấp có 2.5V thôi, vì cái chênh áp giữa nguồn và đất nó thấp, khi chênh áp thấp như vậy thì công suất tiêu thụ ít hơn.
3 giá trị trên phổ biến vì trên thị trường có nhiều IC ổn áp tạo ra mức điện áp ổn điịnh ở 3 mức này


### 7. Bộ nhớ Flash, SRAM bao nhiêu?

- 1024 kByte Flash Memory
- 192 kByte SRAM in system, 4 kByte in Backup

Thường thì mọi người sẽ trả lời giá trị của bộ nhớ nằm trong 1 khoảng giá trị, tuy nhiên đây là thông số cho toàn bộ 1 MCU family. Với 1 con chip cụ thể thì nó có 1 giá trị xác định

![Peripherals count](https://github.com/giangnamtud/STM32/assets/165153939/7c70316d-7e13-4841-a9aa-ffa18e2da652)


### 8. Tốc độ tối đa của vi xử lý là bao nhiêu?

- ARM Cortex M4 168Mhz
- 1,25 DMIPS/MHz : 1,25 triệu lệnh trên 1 giây với 1 Mhz. Nhân lên với 168MHz thì có thể thực thi khoảng 210 triệu lệnh trên 1 giây. Lệnh này là Instruction in machine language (mã máy)
